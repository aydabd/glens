name: Release â€” api

# Triggered automatically when cmd/api code is merged into main.
# Creates an annotated semver tag (e.g. cmd/api/v1.0.0), cross-compiles
# binaries for all supported platforms, and publishes a GitHub Release.

on:
  push:
    branches:
      - main
    paths:
      - "cmd/api/**"

# Ensure only one release runs at a time for this module.
# Subsequent pushes are queued rather than cancelled.
concurrency:
  group: release-${{ github.workflow }}
  cancel-in-progress: false

permissions:
  contents: write

jobs:
  release:
    uses: ./.github/workflows/release-module.yml
    with:
      module-path: cmd/api
      module-name: api
      tag-prefix: cmd/api/v
      working-directory: cmd/api
      go-version: "1.25"
      build-binary: true
      binary-name: glens-api
      environment: production
      default-bump: patch
    secrets: inherit
