%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#7c3aed', 'primaryTextColor': '#fff', 'lineColor': '#475569', 'fontSize': '14px'}}}%%
flowchart TD
    REQ["ðŸ–¥ï¸ HTTP Request"] --> MW1["Recovery middleware â€” catch panics"]
    MW1 --> MW2["Logging middleware â€” request/response log"]
    MW2 --> MW3["CORS middleware â€” cross-origin headers"]
    MW3 --> ROUTER["Router â€” http.ServeMux"]

    ROUTER --> H1["GET /healthz â€” version + status"]
    ROUTER --> H2["POST /api/v1/analyze â€” full analysis run"]
    ROUTER --> H3["POST /api/v1/analyze/preview â€” dry-run preview"]
    ROUTER --> H4["GET /api/v1/models â€” list AI models"]
    ROUTER --> H5["POST /api/v1/mcp â€” MCP protocol"]

    H1 --> RESP["JSON Response"]
    H2 --> RESP
    H3 --> RESP
    H4 --> RESP
    H5 --> RESP

    style REQ fill:#0f172a,stroke:#1e293b,color:#fff
    style MW1 fill:#b91c1c,stroke:#991b1b,color:#fff
    style MW2 fill:#7c3aed,stroke:#6d28d9,color:#fff
    style MW3 fill:#7c3aed,stroke:#6d28d9,color:#fff
    style ROUTER fill:#1e40af,stroke:#1e3a8a,color:#fff
    style H1 fill:#15803d,stroke:#166534,color:#fff
    style H2 fill:#b45309,stroke:#92400e,color:#fff
    style H3 fill:#b45309,stroke:#92400e,color:#fff
    style H4 fill:#0369a1,stroke:#075985,color:#fff
    style H5 fill:#6d28d9,stroke:#5b21b6,color:#fff
    style RESP fill:#15803d,stroke:#166534,color:#fff
